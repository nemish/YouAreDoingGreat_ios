{
    "openapi": "3.0.3",
    "info": {
        "title": "You Are Doing Great API",
        "description": "API for managing user moments and user profiles with cursor-based pagination",
        "version": "1.0.0",
        "contact": {
            "name": "API Support",
            "email": "support@example.com"
        }
    },
    "servers": [
        {
            "url": "http://localhost:3000/api/v1",
            "description": "Production server"
        }
    ],
    "paths": {
        "/health": {
            "get": {
                "summary": "API health check endpoint",
                "description": "Health check endpoint for monitoring. This endpoint does NOT require app token authentication.\nReturns MongoDB connection status and overall API health.\n",
                "operationId": "healthCheck",
                "security": [],
                "responses": {
                    "200": {
                        "description": "API is healthy",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "status": {
                                            "type": "string",
                                            "enum": [
                                                "ok",
                                                "degraded"
                                            ],
                                            "example": "ok"
                                        },
                                        "checks": {
                                            "type": "object",
                                            "properties": {
                                                "mongodb": {
                                                    "type": "string",
                                                    "enum": [
                                                        "connected",
                                                        "disconnected"
                                                    ],
                                                    "example": "connected"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "API is degraded (some services unavailable)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "status": {
                                            "type": "string",
                                            "example": "degraded"
                                        },
                                        "checks": {
                                            "type": "object",
                                            "properties": {
                                                "mongodb": {
                                                    "type": "string",
                                                    "example": "disconnected"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/user/me": {
            "get": {
                "summary": "Get current user profile",
                "description": "Retrieve the current user's profile information.\n\n**Subscription Status Sync:** This endpoint triggers a background sync with RevenueCat\nto verify subscription status if the cached status is older than 24 hours. The sync\nruns asynchronously (fire-and-forget) and does not delay the response. The returned\nstatus reflects the current database value; subsequent requests will show updated\nstatus after the background sync completes.\n",
                "operationId": "getCurrentUser",
                "security": [
                    {
                        "appToken": [],
                        "userAuth": []
                    }
                ],
                "responses": {
                    "200": {
                        "description": "User profile retrieved successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/UserResponse"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - Invalid or missing app token (INVALID_APP_TOKEN) or user ID (RESTRICTED_ACCESS)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/user/stats": {
            "get": {
                "summary": "Get user statistics",
                "description": "Retrieve statistics about user's moment submissions including streaks and totals",
                "operationId": "getUserStats",
                "security": [
                    {
                        "appToken": [],
                        "userAuth": []
                    }
                ],
                "responses": {
                    "200": {
                        "description": "User statistics retrieved successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/UserStatsResponse"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - Invalid or missing app token (INVALID_APP_TOKEN) or user ID (RESTRICTED_ACCESS)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/user/feedback": {
            "post": {
                "summary": "Submit user feedback",
                "description": "Submit feedback from the user including title and description",
                "operationId": "submitUserFeedback",
                "security": [
                    {
                        "appToken": [],
                        "userAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/CreateUserFeedbackRequest"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Feedback submitted successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/CreateUserFeedbackResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad request (invalid input)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - Invalid or missing app token (INVALID_APP_TOKEN) or user ID (RESTRICTED_ACCESS)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/timeline": {
            "get": {
                "summary": "Get timeline with pagination",
                "description": "Retrieve user day summaries with cursor-based pagination for infinite scrolling timeline.\n\n**Timeline Restriction:** Free users can only access data from the last 14 days.\nData older than 14 days is filtered out and `limitReached` is set to true.\nPremium users have unlimited access to their full history.\n",
                "operationId": "getTimeline",
                "security": [
                    {
                        "appToken": [],
                        "userAuth": []
                    }
                ],
                "parameters": [
                    {
                        "name": "cursor",
                        "in": "query",
                        "description": "Date cursor for pagination (ISO date).",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "format": "date-time",
                            "example": "2024-01-15T00:00:00Z"
                        }
                    },
                    {
                        "name": "limit",
                        "in": "query",
                        "description": "Number of items per page",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "minimum": 1,
                            "maximum": 100,
                            "default": 20,
                            "example": 20
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successful response",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PaginatedTimelineResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - Invalid or missing app token (INVALID_APP_TOKEN) or user ID (RESTRICTED_ACCESS)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/moments": {
            "get": {
                "summary": "Get moments with pagination",
                "description": "Retrieve user moments with cursor-based pagination for infinite scrolling.\n\n**Timeline Restriction:** Free users can only access data from the last 14 days.\nData older than 14 days is filtered out and `limitReached` is set to true.\nPremium users have unlimited access to their full history.\n",
                "operationId": "getMoments",
                "security": [
                    {
                        "appToken": [],
                        "userAuth": []
                    }
                ],
                "parameters": [
                    {
                        "name": "cursor",
                        "in": "query",
                        "description": "Timestamp cursor for pagination.",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "format": "date-time",
                            "example": "2024-01-15T10:30:00Z"
                        }
                    },
                    {
                        "name": "limit",
                        "in": "query",
                        "description": "Number of items per page",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "minimum": 1,
                            "maximum": 100,
                            "default": 20,
                            "example": 20
                        }
                    },
                    {
                        "name": "isFavorite",
                        "in": "query",
                        "description": "Filter to show only favorite moments",
                        "required": false,
                        "schema": {
                            "type": "boolean",
                            "default": false,
                            "example": true
                        }
                    },
                    {
                        "name": "tag",
                        "in": "query",
                        "description": "Filter moments by tag name (case-insensitive)",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "minLength": 1,
                            "maxLength": 50,
                            "example": "self_care"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successful response",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PaginatedMomentsResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - Invalid or missing app token (INVALID_APP_TOKEN) or user ID (RESTRICTED_ACCESS)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "post": {
                "summary": "Create a new moment (without AI enrichment)",
                "description": "Create a moment record in the database without AI processing.\nThe moment is created immediately with undefined action, tags, and praise.\nUse POST /moments/{id}/enrich to add AI-generated content.\n",
                "operationId": "createMoment",
                "security": [
                    {
                        "appToken": [],
                        "userAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/CreateMomentRequest"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Moment created successfully (without enrichment)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/CreateMomentResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad request - total or daily limit reached",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                },
                                "examples": {
                                    "totalLimitReached": {
                                        "summary": "Total limit reached",
                                        "value": {
                                            "error": {
                                                "code": "TOTAL_LIMIT_REACHED",
                                                "message": "You've reached your limit of 10 total moments. Upgrade to premium for unlimited moments!"
                                            },
                                            "meta": {
                                                "limit": 10,
                                                "isPremium": false
                                            }
                                        }
                                    },
                                    "dailyLimitReached": {
                                        "summary": "Daily limit reached",
                                        "value": {
                                            "error": {
                                                "code": "DAILY_LIMIT_REACHED",
                                                "message": "You've reached your daily limit of 3 moments. Upgrade to premium for 30 moments per day!"
                                            },
                                            "meta": {
                                                "limit": 3,
                                                "isPremium": false
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - Invalid or missing app token (INVALID_APP_TOKEN) or user ID (RESTRICTED_ACCESS)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/moments/by-client-id/{clientId}": {
            "get": {
                "summary": "Get a moment by client ID",
                "description": "Retrieve a specific moment by its client-generated UUID (used for offline sync correlation).\nNo timeline restriction applies when fetching individual moments.\n",
                "operationId": "getMomentByClientId",
                "security": [
                    {
                        "appToken": [],
                        "userAuth": []
                    }
                ],
                "parameters": [
                    {
                        "name": "clientId",
                        "in": "path",
                        "description": "Client-generated UUID for the moment",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "format": "uuid",
                            "example": "550e8400-e29b-41d4-a716-446655440000"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Moment retrieved successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/GetMomentResponse"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - Invalid or missing app token (INVALID_APP_TOKEN) or user ID (RESTRICTED_ACCESS)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Forbidden - User does not own this moment",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Moment not found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/moments/{id}": {
            "get": {
                "summary": "Get a specific moment",
                "description": "Retrieve a specific moment by ID.\nNo timeline restriction applies when fetching individual moments.\n",
                "operationId": "getMoment",
                "security": [
                    {
                        "appToken": [],
                        "userAuth": []
                    }
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "Moment ID",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Moment retrieved successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/GetMomentResponse"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - Invalid or missing app token (INVALID_APP_TOKEN) or user ID (RESTRICTED_ACCESS)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Forbidden - User does not own this moment",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Moment not found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "put": {
                "summary": "Update a moment",
                "description": "Update a specific moment (currently supports updating favorite status)",
                "operationId": "updateMoment",
                "security": [
                    {
                        "appToken": [],
                        "userAuth": []
                    }
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "Moment ID",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/UpdateMomentRequest"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Moment updated successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/UpdateMomentResponse"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - Invalid or missing app token (INVALID_APP_TOKEN) or user ID (RESTRICTED_ACCESS)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Forbidden - User does not own this moment",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Moment not found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    }
                }
            },
            "delete": {
                "summary": "Archive a moment",
                "description": "Soft delete a moment by setting archivedAt timestamp",
                "operationId": "archiveMoment",
                "security": [
                    {
                        "appToken": [],
                        "userAuth": []
                    }
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "Moment ID",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Moment archived successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ArchiveMomentResponse"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - Invalid or missing app token (INVALID_APP_TOKEN) or user ID (RESTRICTED_ACCESS)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Forbidden - User does not own this moment",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Moment not found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/moments/{id}/restore": {
            "post": {
                "summary": "Restore an archived moment",
                "description": "Restore a previously archived moment by clearing the archivedAt timestamp.\nThis operation is idempotent - restoring an already-active moment returns success without error.\nStats and day summaries are updated asynchronously in the background.\n\n**Note**: Restoring a moment does not count against daily creation limits.\n",
                "operationId": "restoreMoment",
                "security": [
                    {
                        "appToken": [],
                        "userAuth": []
                    }
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "Moment ID",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Moment restored successfully (or was already active)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "item": {
                                            "$ref": "#/components/schemas/MomentFull"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - Invalid or missing app token (INVALID_APP_TOKEN) or user ID (RESTRICTED_ACCESS)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Forbidden - User does not own this moment",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Moment not found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/moments/{id}/enrich": {
            "post": {
                "summary": "Enrich a moment with AI-generated content",
                "description": "Add AI-generated action category, tags, and praise to an existing moment.\nThis endpoint is idempotent - if the moment is already enriched, it returns\nthe existing data without calling the AI again. Checks daily limits before\nprocessing.\n",
                "operationId": "enrichMoment",
                "security": [
                    {
                        "appToken": [],
                        "userAuth": []
                    }
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "description": "Moment ID to enrich",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Moment enriched successfully (or already enriched)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/EnrichMomentResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad request (e.g., daily limit reached)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - Invalid or missing app token (INVALID_APP_TOKEN) or user ID (RESTRICTED_ACCESS)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "403": {
                        "description": "Forbidden - User does not own this moment",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Moment not found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "409": {
                        "description": "Enrichment already in progress",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/webhooks/revenuecat": {
            "post": {
                "summary": "RevenueCat webhook endpoint",
                "description": "Webhook endpoint for RevenueCat subscription events. Updates user subscription\nstatus based on purchase, renewal, and expiration events.\n\n**Authentication:** Requires `Authorization` header with RevenueCat webhook secret.\nDoes NOT use x-app-token-code or x-user-id headers.\n\n**Events that grant premium status:**\n- INITIAL_PURCHASE\n- RENEWAL\n- UNCANCELLATION\n- SUBSCRIPTION_EXTENDED\n\n**Events that revoke premium status:**\n- EXPIRATION\n\n**Events logged but no status change:**\n- CANCELLATION (user keeps access until expiration)\n- BILLING_ISSUE (grace period)\n- PRODUCT_CHANGE\n- SUBSCRIPTION_PAUSED\n- TRANSFER\n- TEST\n",
                "operationId": "revenueCatWebhook",
                "security": [
                    {
                        "revenueCatAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/RevenueCatWebhookPayload"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Webhook processed successfully",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "received": {
                                            "type": "boolean",
                                            "example": true
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad request (invalid payload)",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "example": "Invalid payload"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized - Invalid or missing webhook auth",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "components": {
        "schemas": {
            "User": {
                "type": "object",
                "required": [
                    "id",
                    "userId",
                    "status"
                ],
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Unique identifier for the user",
                        "example": "user_123"
                    },
                    "userId": {
                        "type": "string",
                        "description": "External user ID from authentication system",
                        "example": "auth0|123456789"
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "free",
                            "premium"
                        ],
                        "description": "User subscription status",
                        "example": "free"
                    }
                }
            },
            "Moment": {
                "type": "object",
                "required": [
                    "id",
                    "text",
                    "submittedAt",
                    "happenedAt",
                    "tz"
                ],
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Unique identifier for the moment",
                        "example": "moment_123"
                    },
                    "clientId": {
                        "type": "string",
                        "format": "uuid",
                        "nullable": true,
                        "description": "Client-generated UUID for offline sync correlation",
                        "example": "550e8400-e29b-41d4-a716-446655440000"
                    },
                    "text": {
                        "type": "string",
                        "description": "The moment text content",
                        "example": "Today was amazing!"
                    },
                    "submittedAt": {
                        "type": "string",
                        "format": "date-time",
                        "description": "When the moment was submitted",
                        "example": "2024-01-15T10:30:00Z"
                    },
                    "happenedAt": {
                        "type": "string",
                        "format": "date-time",
                        "description": "When the moment actually happened (calculated as submittedAt - timeAgo)",
                        "example": "2024-01-15T09:30:00Z"
                    },
                    "tz": {
                        "type": "string",
                        "description": "Timezone of the user",
                        "example": "America/New_York"
                    },
                    "action": {
                        "type": "string",
                        "nullable": true,
                        "description": "Normalized action category (null until enriched)",
                        "example": "exercise"
                    },
                    "tags": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        },
                        "nullable": true,
                        "description": "Tags from normalization (null/empty until enriched)",
                        "example": [
                            "milestone",
                            "writing",
                            "streak"
                        ]
                    },
                    "praise": {
                        "type": "string",
                        "nullable": true,
                        "description": "AI-generated praise (null until enriched)",
                        "example": "Great job! You're making amazing progress!"
                    },
                    "isFavorite": {
                        "type": "boolean",
                        "description": "Whether the moment is marked as favorite",
                        "example": false
                    },
                    "timeAgo": {
                        "type": "integer",
                        "nullable": true,
                        "description": "Seconds passed from when the moment actually happened to when it was submitted",
                        "example": 3600
                    }
                }
            },
            "CreateMomentRequest": {
                "type": "object",
                "required": [
                    "text"
                ],
                "properties": {
                    "clientId": {
                        "type": "string",
                        "format": "uuid",
                        "description": "Client-generated UUID for offline sync correlation. Server echoes this back in response.",
                        "example": "550e8400-e29b-41d4-a716-446655440000"
                    },
                    "text": {
                        "type": "string",
                        "description": "The moment text content",
                        "minLength": 1,
                        "maxLength": 1000,
                        "example": "New moment text"
                    },
                    "submittedAt": {
                        "type": "string",
                        "format": "date-time",
                        "description": "When the moment was submitted (optional, defaults to current time)",
                        "example": "2024-01-15T10:30:00Z"
                    },
                    "tz": {
                        "type": "string",
                        "description": "Timezone of the user",
                        "example": "America/New_York"
                    },
                    "timeAgo": {
                        "type": "integer",
                        "nullable": true,
                        "description": "Seconds passed from when the moment actually happened to when it was submitted (optional)",
                        "example": 3600
                    }
                }
            },
            "CreateMomentResponse": {
                "type": "object",
                "required": [
                    "item"
                ],
                "properties": {
                    "item": {
                        "$ref": "#/components/schemas/Moment"
                    }
                }
            },
            "GetMomentResponse": {
                "type": "object",
                "required": [
                    "item"
                ],
                "properties": {
                    "item": {
                        "$ref": "#/components/schemas/Moment"
                    }
                }
            },
            "UpdateMomentRequest": {
                "type": "object",
                "required": [
                    "isFavorite"
                ],
                "properties": {
                    "isFavorite": {
                        "type": "boolean",
                        "description": "Whether to mark the moment as favorite",
                        "example": true
                    }
                }
            },
            "UpdateMomentResponse": {
                "type": "object",
                "required": [
                    "message"
                ],
                "properties": {
                    "message": {
                        "type": "string",
                        "description": "Success message",
                        "example": "Moment updated"
                    }
                }
            },
            "ArchiveMomentResponse": {
                "type": "object",
                "required": [
                    "message"
                ],
                "properties": {
                    "message": {
                        "type": "string",
                        "description": "Success message",
                        "example": "Moment archived"
                    }
                }
            },
            "EnrichMomentResponse": {
                "type": "object",
                "required": [
                    "item"
                ],
                "properties": {
                    "item": {
                        "$ref": "#/components/schemas/Moment"
                    }
                }
            },
            "DaySummary": {
                "type": "object",
                "required": [
                    "id",
                    "date",
                    "text",
                    "tags",
                    "momentsCount",
                    "timesOfDay",
                    "state",
                    "createdAt"
                ],
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Unique identifier for the day summary",
                        "example": "summary_123"
                    },
                    "date": {
                        "type": "string",
                        "format": "date-time",
                        "description": "The date this summary represents (start of day)",
                        "example": "2024-01-15T00:00:00Z"
                    },
                    "text": {
                        "type": "string",
                        "nullable": true,
                        "description": "AI-generated summary text (null if no moments for this day)",
                        "example": "You had a productive day with 5 workouts and quality family time!"
                    },
                    "tags": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        },
                        "description": "Top 5 most popular tags from moments on this day",
                        "example": [
                            "exercise",
                            "mindfulness",
                            "productivity"
                        ]
                    },
                    "momentsCount": {
                        "type": "integer",
                        "description": "Total number of moments logged on this day",
                        "example": 12
                    },
                    "timesOfDay": {
                        "type": "array",
                        "items": {
                            "type": "string",
                            "enum": [
                                "sunrise",
                                "cloud-sun",
                                "sun-medium",
                                "sunset",
                                "moon"
                            ]
                        },
                        "description": "Array of time periods when moments were logged (sunrise=5-8am, cloud-sun=8am-12pm, sun-medium=12-5pm, sunset=5-8pm, moon=night)",
                        "example": [
                            "cloud-sun",
                            "sun-medium",
                            "sunset"
                        ]
                    },
                    "state": {
                        "type": "string",
                        "enum": [
                            "INPROGRESS",
                            "FINALISED"
                        ],
                        "description": "The processing state of the day summary:\n- INPROGRESS: Summary exists but AI text generation has not completed yet\n- FINALISED: Summary is complete with AI-generated text and all metadata\n",
                        "example": "FINALISED"
                    },
                    "createdAt": {
                        "type": "string",
                        "format": "date-time",
                        "description": "When the summary was created",
                        "example": "2024-01-16T02:00:00Z"
                    }
                }
            },
            "PaginatedTimelineResponse": {
                "type": "object",
                "required": [
                    "data",
                    "hasNextPage",
                    "limitReached"
                ],
                "properties": {
                    "data": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/DaySummary"
                        },
                        "description": "Array of day summaries"
                    },
                    "nextCursor": {
                        "type": "string",
                        "format": "date-time",
                        "nullable": true,
                        "description": "Date cursor for the next page",
                        "example": "2024-01-15T00:00:00Z"
                    },
                    "hasNextPage": {
                        "type": "boolean",
                        "description": "Whether there are more pages available",
                        "example": true
                    },
                    "limitReached": {
                        "type": "boolean",
                        "description": "Whether the user has reached their timeline limit (true for free users when older data exists, always false for premium)",
                        "example": false
                    }
                }
            },
            "PaginatedMomentsResponse": {
                "type": "object",
                "required": [
                    "data",
                    "hasNextPage",
                    "limitReached"
                ],
                "properties": {
                    "data": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/Moment"
                        },
                        "description": "Array of moments"
                    },
                    "nextCursor": {
                        "type": "string",
                        "format": "date-time",
                        "nullable": true,
                        "description": "Cursor for the next page",
                        "example": "2024-01-15T10:30:00Z"
                    },
                    "hasNextPage": {
                        "type": "boolean",
                        "description": "Whether there are more pages available",
                        "example": true
                    },
                    "limitReached": {
                        "type": "boolean",
                        "description": "Whether the user has reached their timeline limit (true for free users when older data exists, always false for premium)",
                        "example": false
                    }
                }
            },
            "UserResponse": {
                "type": "object",
                "required": [
                    "item"
                ],
                "properties": {
                    "item": {
                        "$ref": "#/components/schemas/User"
                    }
                }
            },
            "UserStats": {
                "type": "object",
                "required": [
                    "userId",
                    "totalMoments",
                    "momentsToday",
                    "momentsYesterday",
                    "currentStreak",
                    "longestStreak"
                ],
                "properties": {
                    "userId": {
                        "type": "string",
                        "description": "External user ID from authentication system",
                        "example": "auth0|123456789"
                    },
                    "totalMoments": {
                        "type": "integer",
                        "description": "Total number of moments submitted by the user",
                        "example": 150
                    },
                    "momentsToday": {
                        "type": "integer",
                        "description": "Number of moments submitted today",
                        "example": 2
                    },
                    "momentsYesterday": {
                        "type": "integer",
                        "description": "Number of moments submitted yesterday",
                        "example": 3
                    },
                    "currentStreak": {
                        "type": "integer",
                        "description": "Current consecutive days streak",
                        "example": 7
                    },
                    "longestStreak": {
                        "type": "integer",
                        "description": "Longest consecutive days streak ever achieved",
                        "example": 30
                    },
                    "lastMomentDate": {
                        "type": "string",
                        "format": "date-time",
                        "nullable": true,
                        "description": "Timestamp of the last submitted moment",
                        "example": "2024-01-15T10:30:00Z"
                    }
                }
            },
            "UserStatsResponse": {
                "type": "object",
                "required": [
                    "item"
                ],
                "properties": {
                    "item": {
                        "$ref": "#/components/schemas/UserStats"
                    }
                }
            },
            "UserFeedback": {
                "type": "object",
                "required": [
                    "id",
                    "title",
                    "text",
                    "createdAt"
                ],
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Unique identifier for the feedback",
                        "example": "feedback_123"
                    },
                    "title": {
                        "type": "string",
                        "description": "Title of the feedback",
                        "example": "Bug in moment submission"
                    },
                    "text": {
                        "type": "string",
                        "description": "Detailed feedback text",
                        "example": "I noticed that when I submit a moment with a very long text..."
                    },
                    "createdAt": {
                        "type": "string",
                        "format": "date-time",
                        "description": "When the feedback was submitted",
                        "example": "2024-01-15T10:30:00Z"
                    }
                }
            },
            "CreateUserFeedbackRequest": {
                "type": "object",
                "required": [
                    "title",
                    "text"
                ],
                "properties": {
                    "title": {
                        "type": "string",
                        "description": "Title of the feedback",
                        "minLength": 1,
                        "maxLength": 200,
                        "example": "Feature request"
                    },
                    "text": {
                        "type": "string",
                        "description": "Detailed feedback text",
                        "minLength": 1,
                        "maxLength": 5000,
                        "example": "It would be great if the app had..."
                    }
                }
            },
            "CreateUserFeedbackResponse": {
                "type": "object",
                "required": [
                    "item"
                ],
                "properties": {
                    "item": {
                        "$ref": "#/components/schemas/UserFeedback"
                    }
                }
            },
            "RevenueCatWebhookPayload": {
                "type": "object",
                "required": [
                    "api_version",
                    "event"
                ],
                "properties": {
                    "api_version": {
                        "type": "string",
                        "description": "RevenueCat API version",
                        "example": "1.0"
                    },
                    "event": {
                        "type": "object",
                        "required": [
                            "type",
                            "id",
                            "app_user_id"
                        ],
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": [
                                    "INITIAL_PURCHASE",
                                    "RENEWAL",
                                    "EXPIRATION",
                                    "CANCELLATION",
                                    "BILLING_ISSUE",
                                    "PRODUCT_CHANGE",
                                    "UNCANCELLATION",
                                    "SUBSCRIPTION_PAUSED",
                                    "SUBSCRIPTION_EXTENDED",
                                    "TRANSFER",
                                    "TEST"
                                ],
                                "description": "Type of RevenueCat event",
                                "example": "INITIAL_PURCHASE"
                            },
                            "id": {
                                "type": "string",
                                "description": "Unique event identifier",
                                "example": "event_123456"
                            },
                            "app_user_id": {
                                "type": "string",
                                "description": "User ID in RevenueCat (may be an alias)",
                                "example": "user_123"
                            },
                            "original_app_user_id": {
                                "type": "string",
                                "description": "Original user ID (stable identifier)",
                                "example": "user_123"
                            },
                            "product_id": {
                                "type": "string",
                                "description": "Product identifier",
                                "example": "premium_monthly"
                            },
                            "entitlement_ids": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                },
                                "description": "Entitlements granted",
                                "example": [
                                    "premium"
                                ]
                            },
                            "expiration_at_ms": {
                                "type": "integer",
                                "description": "Expiration timestamp in milliseconds",
                                "example": 1704067200000
                            },
                            "store": {
                                "type": "string",
                                "description": "Store the purchase was made in",
                                "example": "APP_STORE"
                            }
                        }
                    }
                }
            },
            "ErrorResponse": {
                "type": "object",
                "required": [
                    "error"
                ],
                "properties": {
                    "error": {
                        "type": "object",
                        "required": [
                            "code",
                            "message"
                        ],
                        "properties": {
                            "code": {
                                "type": "string",
                                "enum": [
                                    "UNAUTHORIZED",
                                    "RESTRICTED_ACCESS",
                                    "INTERNAL_SERVER_ERROR",
                                    "DAILY_LIMIT_REACHED",
                                    "TOTAL_LIMIT_REACHED",
                                    "INVALID_CURSOR",
                                    "MOMENT_NOT_FOUND",
                                    "FORBIDDEN",
                                    "INVALID_REQUEST",
                                    "ENRICHMENT_IN_PROGRESS",
                                    "INVALID_APP_TOKEN",
                                    "INVALID_WEBHOOK_AUTH",
                                    "VALIDATION_ERROR",
                                    "RATE_LIMIT_EXCEEDED",
                                    "CONFLICT"
                                ],
                                "description": "Machine-readable error code",
                                "example": "DAILY_LIMIT_REACHED"
                            },
                            "message": {
                                "type": "string",
                                "description": "Human-readable error message",
                                "example": "You've reached your daily limit of 10 moments. Upgrade to premium for 50 moments per day!"
                            }
                        }
                    },
                    "meta": {
                        "type": "object",
                        "description": "Optional additional metadata about the error",
                        "additionalProperties": true,
                        "example": {
                            "limit": 10,
                            "isPremium": false
                        }
                    }
                }
            }
        },
        "securitySchemes": {
            "appToken": {
                "type": "apiKey",
                "in": "header",
                "name": "x-app-token-code",
                "description": "App token for API access validation. Required for all /api/* endpoints except /api/health and webhooks."
            },
            "userAuth": {
                "type": "apiKey",
                "in": "header",
                "name": "x-user-id",
                "description": "User ID for authentication"
            },
            "revenueCatAuth": {
                "type": "http",
                "scheme": "bearer",
                "description": "RevenueCat webhook authorization. Configure this secret in RevenueCat dashboard."
            }
        }
    },
    "security": [
        {
            "appToken": []
        }
    ]
}
